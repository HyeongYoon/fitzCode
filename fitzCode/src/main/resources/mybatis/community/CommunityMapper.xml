<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.fitzcode.community.mapper.CommunityMapper">

    <!--상품 태그 검색용 -->
    <select id="searchProductsByName" resultType="ProductDTO">
        SELECT product_id, product_name, image_url
        FROM products
        WHERE product_name LIKE CONCAT('%', #{productName}, '%')
        LIMIT 10 OFFSET #{offset}
    </select>

    <insert id="insertPostTagByProductName" parameterType="PostTagDTO">
        INSERT INTO POST_TAG (post_id, product_id)
        SELECT #{postId}, p.product_id
        FROM PRODUCT p
        WHERE p.product_name LIKE CONCAT('%', #{productName}, '%')
        ON DUPLICATE KEY UPDATE post_id = post_id;
    </insert>

    <insert id="insertPost" parameterType="PostDTO">
        INSERT INTO POST (user_id, style_category, title, content, thumbnail_image_url)
        VALUES (#{userId}, #{styleCategory}, #{title}, #{content}, #{thumbnailImageUrl});
    </insert>


</mapper>