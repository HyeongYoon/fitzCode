<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>communityForm</title>
    <style>
        main {
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
        }

        h1 {
            color: #2f2f32;
            font-size: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 95%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            resize: none;
        }


        .form-group textarea {
            height: 100px;
        }

        .form-group input[type="file"] {
            padding: 10px;
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag-input input {
            flex: 1;
            min-width: 200px;
        }


        .tag-input button {
            background-color: #2f2f32;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .tag-input button:hover {
            background-color: #2f2f32;
        }

        .form-group .error {
            color: red;
            font-size: 12px;
        }

        .submit-button {
            background-color: #2f2f32;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
        }

        .submit-button:hover {
            background-color: #2f2f32;
        }

        /*!* 이미지 미리보기 슬라이드 효과 *!*/
        /*.image-preview-container {*/
        /*    display: flex;*/
        /*    overflow-x: auto;*/
        /*    gap: 10px;*/
        /*    margin-top: 15px;*/
        /*    padding-bottom: 10px; !* 스크롤바와 겹치지 않게 *!*/
        /*}*/

        /*.image-preview img {*/
        /*    width: 100%;*/
        /*    height: 100%;*/
        /*    object-fit: cover;*/
        /*    border-radius: 8px;*/
        /*}*/

        .image-preview-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            margin-top: 15px;
            padding-bottom: 10px;
        }

        .image-preview-container img {
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            margin: 5px;
        }

        .file-name-list {
            margin-top: 10px;
            list-style: none;
            padding: 0;
        }

        .file-name-list li {
            padding: 5px;
            background-color: #f4f4f4;
            margin-bottom: 5px;
            border-radius: 4px;
        }

        .line {
            width: 100%;
            height: 4px;
            background-color: #2f2f32;
            margin: 20px 0;
        }

        .style-tag {
            background-color: #ffffff;
            border: 1px solid #2f2f32;
            padding: 8px 12px;
            border-radius: 15px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .style-tag.selected {
            background-color: #2f2f32;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            padding: 20px;
            width: 400px;
            margin: 150px auto;
            border-radius: 8px;
            text-align: center;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .search-results {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        /*.product-item {*/
        /*    width: 100px;*/
        /*    height: 100px;*/
        /*    position: relative;*/
        /*    cursor: pointer;*/
        /*    border: 2px solid transparent;*/
        /*    border-radius: 8px;*/
        /*    overflow: hidden;*/
        /*}*/

        .product-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 선택한 상품 표시 */
        #tagList {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .selected-product {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
        }

        .selected-product img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>

<!-- header -->
<div th:replace="~{fragments/header}"></div>

<!-- 메인 콘텐츠 -->
<main>
    <h1>커뮤니티 글 작성</h1>
    <div class="line">
    </div>
    <br>
    <!--    <form action="#" method="post" enctype="multipart/form-data">-->
    <!-- 제목 입력 -->
    <div class="form-group">
        <label for="title">제목</label>
        <input type="text" id="title" name="title" placeholder="제목을 입력하세요" required>
        <div class="error" id="titleError"></div>
    </div>

    <!-- 내용 입력 -->
    <div class="form-group">
        <label for="content">내용</label>
        <textarea id="content" name="content" placeholder="내용을 입력하세요" required></textarea>
        <div class="error" id="contentError"></div>
    </div>

    <!-- 이미지 첨부 -->
    <div class="form-group">
        <label for="image">이미지 첨부</label>
        <input type="file" id="image" name="image" accept="image/*" multiple>
        <!-- 이미지 미리보기 컨테이너 -->
        <div id="imagePreviewContainer" class="image-preview-container"></div>
        <!-- 파일 이름 리스트 -->
        <ul id="fileNameList" class="file-name-list"></ul>
    </div>

    <!-- 상품 태그 -->
    <div class="form-group">
        <label for="tags">상품 태그</label>
        <div class="tag-input">
            <button type="button" id="addTagButton">태그 추가</button>
        </div>
        <br><br>
        <div id="tagList" class="tag-list"></div>
    </div>

    <!-- 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>상품 검색</h2>
            <input type="text" id="productName" name="productName" placeholder="상품을 검색하세요">
            <button type="button" id="searchButton">검색</button>
            <div id="searchResults" class="search-results"></div>
        </div>
    </div>

    <!-- 스타일 태그 -->
    <div class="form-group">
        <label>스타일 태그 (최대 2개 선택 가능)</label>
        <div id="styleTagContainer">
            <button type="button" class="style-tag" data-style="캐주얼">캐주얼</button>
            <button type="button" class="style-tag" data-style="스트릿">스트릿</button>
            <button type="button" class="style-tag" data-style="시크">시크</button>
            <button type="button" class="style-tag" data-style="고프코어">고프코어</button>
            <button type="button" class="style-tag" data-style="클래식">클래식</button>
        </div>
        <div id="selectedStyles" class="selected-styles"></div>
    </div>
    <br>
    <!-- 제출 버튼 -->
    <div class="form-group">
        <button type="submit" class="submit-button">업로드</button>
    </div>

    <!--    </form>-->
</main>

<!-- footer -->
<div th:replace="~{fragments/footer}"></div>

<script>
    document.getElementById("image").addEventListener("change", function (event) {
        const files = event.target.files;
        const imagePreviewContainer = document.getElementById("imagePreviewContainer");
        const fileNameList = document.getElementById("fileNameList");

        if (files) {
            Array.from(files).forEach(file => {
                // 이미 존재하는 파일인지 체크 (삭제 후 다시 추가될 수 있도록)
                const existingFile = fileNameList.querySelector(`[data-file="${file.name}"]`);
                if (existingFile) return;  // 이미 추가된 파일이면 처리하지 않음

                const reader = new FileReader();

                reader.onload = function (e) {
                    const imgContainer = document.createElement("div");
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.classList.add("image-preview");
                    imgContainer.appendChild(img);

                    // 이미지 클릭 시 해당 이미지 삭제
                    img.addEventListener("click", function () {
                        imagePreviewContainer.removeChild(imgContainer);
                        fileNameList.removeChild(fileNameList.querySelector(`[data-file="${file.name}"]`));
                    });

                    imagePreviewContainer.appendChild(imgContainer);
                };

                reader.readAsDataURL(file);

                // 파일 이름 리스트에 추가
                const fileNameItem = document.createElement("li");
                fileNameItem.textContent = file.name;
                fileNameItem.setAttribute("data-file", file.name);
                fileNameList.appendChild(fileNameItem);
            });
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        // 모달 열기 버튼 클릭 이벤트
        document.getElementById("addTagButton").addEventListener("click", function () {
            const modal = document.getElementById("productModal");
            modal.style.display = "block"; // 모달 표시
        });

        // 모달 닫기 버튼 클릭 이벤트
        document.querySelector(".close").addEventListener("click", function () {
            const modal = document.getElementById("productModal");
            modal.style.display = "none"; // 모달 숨기기
        });

        // 모달 외부 클릭 시 모달 닫기
        window.addEventListener("click", function (event) {
            const modal = document.getElementById("productModal");
            if (event.target === modal) {
                modal.style.display = "none"; // 모달 숨기기
            }
        });

        // 스타일 태그 선택 로직
        const styleButtons = document.querySelectorAll(".style-tag");
        let selectedStyles = [];

        styleButtons.forEach(button => {
            button.addEventListener("click", function () {
                const style = button.getAttribute("data-style");
                if (selectedStyles.includes(style)) {
                    selectedStyles = selectedStyles.filter(s => s !== style);
                    button.classList.remove("selected");
                } else if (selectedStyles.length < 2) {
                    selectedStyles.push(style);
                    button.classList.add("selected");
                }
            });
        });
    });
    // 상품 검색
    $(document).ready(function () {
        // 검색 버튼 클릭 시
        $('#searchButton').on('click', function () {
            var productName = $('#productName').val();
            var offset = 0;  // 기본값: 첫 번째 페이지

            // 상품 검색 API 호출
            $.ajax({
                url: '/api/community/search-products',
                method: 'GET',
                data: {
                    productName: productName,
                    offset: offset
                },
                success: function (data) {
                    // 결과를 화면에 표시
                    var html = '';
                    data.forEach(function (product) {
                        html += '<div>';
                        html += '<h3>' + product.productName + '</h3>';
                        html += '<img src="' + product.imageUrl + '" alt="' + product.productName + '" width="200"/>';
                        html += '</div>';
                    });
                    $('#productList').html(html);
                },
                error: function (error) {
                    console.error("상품 검색 실패:", error);
                }
            });
        });
    });
</script>

</body>
</html>