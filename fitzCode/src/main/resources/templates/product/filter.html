<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Sidebar</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link th:fragment="filter-css" rel="stylesheet" th:href="@{/css/product/filter.css}">
</head>
<body>

<div class="filter-sidebar" th:fragment="filter-body">
    <button class="close-button">&times;</button>
    <h3>Filters</h3>
    
    <form action="/product/filterList" method="GET" id="filter-form">
        <div id="categories-container">
        
        
        </div>
        <input type="submit" value="apply" class="apply-button">
    </form>
</div>

<script th:fragment="filter-script">
    $(document).ready(function() {
        $(".filter-button").click(function() {
            $(".filter-sidebar").toggleClass("active");
        });
        $(".close-button").click(function() {
            $(".filter-sidebar").removeClass("active");
        });
        $(document).click(function(event) {
            if (!$(event.target).closest(".filter-sidebar, .filter-button").length) {
                $(".filter-sidebar").removeClass("active");
            }
        });
        
        $.ajax({
            url: "/api/product/category",
            method: "GET",
            dataType: "json",
            success: function (data) {
                const categoriesContainer = $("#categories-container");
                const categoryMap = {};
                
                // console.log(data);
                // create category map and organize according to parentId
                data.forEach(category => {
                    if (!categoryMap[category.parentId]) {
                        categoryMap[category.parentId] = [];
                    }
                    categoryMap[category.parentId].push(category);
                });

                // draw the html
                if (categoryMap[0]) {
                    categoryMap[0].forEach(parentCategory => {
                        const categorySection = $(`
                            <div class="categories">
                                <span>${parentCategory.name}</span>
                                <div class="subcategories" id="category-${parentCategory.categoryId}"></div>
                            </div>
                        `);
                        categoriesContainer.append(categorySection);

                        // add subcategories if they exist
                        if (categoryMap[parentCategory.categoryId]) {
                            categoryMap[parentCategory.categoryId].forEach(subCategory => {
                                $(`#category-${parentCategory.categoryId}`).append(`
                                    <div class="category-item">
                                        <input type="checkbox" name="${subCategory.code}" id="${subCategory.code}">
                                        <label for="${subCategory.code}">${subCategory.name}</label>
                                    </div>
                                `);
                            });
                        }
                    });
                }
            },
            error: function (xhr, status, error) {
                console.error("Error fetching categories:", error);
            }
        });


        // // when pressed apply button
        // $("#filter-form").submit(function(event) {
        //     event.preventDefault();
        //     let formData = $(this).serialize();
        //     console.log(formData);
        //
        //     $.ajax({
        //         url: "/api/product/filter",
        //         method: "GET",
        //         data: formData,
        //         dataType: "json",
        //         success: function(response) {
        //             console.log("Filter applied successfully:", response);
        //         },
        //         error: function(xhr, status, error) {
        //             console.error("Error applying filter:", error);
        //         }
        //     });
        // });
    });
    
    
</script>
</body>
</html>
